import os
import subprocess
import sys
import tkinter as tk
from tkinter import messagebox, simpledialog
import random
import webbrowser
import time
import ctypes
import psutil

def install_package(package):
    subprocess.check_call([sys.executable, "-m", "pip", "install", package])

required_packages = ["psutil", "ctypes"]

for package in required_packages:
    try:
        __import__(package)
    except ImportError:
        print(f"Installing {package}...")
        install_package(package)

compliments = [
    "You're an amazing person!",
    "You have a great sense of humor!",
    "You're very creative!",
    "You light up the room!",
    "You're a great friend!",
    "You have an incredible work ethic!",
    "You're an inspiration!",
    "You have a fantastic smile!",
    "You're doing great!",
    "You're a true star!",
    "Your positivity is contagious!",
    "You're extremely talented!",
    "You're a beautiful person, inside and out!",
    "You're a problem solver!",
    "You make a difference in the world!",
    "You're so kind-hearted!",
    "You bring joy to everyone around you!",
    "You're incredibly thoughtful!",
    "You're an awesome listener!",
    "You're always so helpful!",
    "You're a true champion!",
    "You have such a great attitude!",
    "You're a real go-getter!",
    "You have a great sense of style!",
    "You're so encouraging!",
    "You're one of a kind!",
    "You're a force of nature!",
    "You're a hard worker!",
    "You make everything better!",
    "You're a great leader!",
    "You have a positive impact on everyone!",
    "You're so intelligent!",
    "You're incredibly strong!",
    "You always know how to brighten someone's day!",
    "You're a problem-solving genius!",
    "You're so graceful!",
    "You're very wise!",
    "You have an amazing sense of compassion!",
    "You're a great mentor!",
    "You're full of great ideas!",
    "You're an awesome teammate!",
    "You have the best ideas!",
    "You're an extraordinary person!",
    "You're always so thoughtful and kind!",
    "You're someone people look up to!",
    "You're a wonderful communicator!",
    "You're so resourceful!",
    "You inspire others to be their best!",
    "You're a natural leader!",
    "You're an awesome friend!"
]

def show_compliment():
    compliment = random.choice(compliments)
    messagebox.showinfo("Good Maker", compliment)
    rainbow_text()

def rainbow_text():
    rainbow_colors = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#8B00FF']
    for i in range(len(rainbow_colors)):
        btn_good_maker.config(fg=rainbow_colors[i])
        time.sleep(0.1)
        btn_good_maker.update_idletasks()

def update_script():
    code = simpledialog.askstring("Enter Update Code", "Enter the new code to replace in the script:")
    if code:
        try:
            with open(__file__, "w") as file:
                file.write(code)
            messagebox.showinfo("Update", "The script has been updated successfully.")
            python = sys.executable
            os.execl(python, python, *sys.argv)
        except Exception as e:
            messagebox.showerror("Error", f"Error while updating the script: {e}")
    else:
        messagebox.showerror("Error", "No code entered. The update was canceled.")

# Load necessary user32 DLL functions for interacting with windows
user32 = ctypes.windll.user32
kernel32 = ctypes.windll.kernel32

# EnumWindows function enumerates all top-level windows
EnumWindows = user32.EnumWindows
EnumWindows.restype = ctypes.c_bool
EnumWindows.argtypes = [ctypes.WINFUNCTYPE(ctypes.c_bool, ctypes.c_int, ctypes.POINTER(ctypes.c_int)), ctypes.c_int]

# Function to check if a window is visible
def is_window_visible(hwnd):
    return user32.IsWindowVisible(hwnd)

# Function to get the PID of the window
def get_window_pid(hwnd):
    pid = ctypes.c_int(0)
    user32.GetWindowThreadProcessId(hwnd, ctypes.byref(pid))
    return pid.value

# Function to close a window by sending a close message
def close_window(hwnd):
    user32.PostMessageW(hwnd, 0x10, 0, 0)  # 0x10 is WM_CLOSE

# Function to check if the process is a visible, user-facing app (not a background process)
def close_running_apps():
    hwnds = []
    checked_pids = set()

    def callback(hwnd, lparam):
        if is_window_visible(hwnd):  # Check if the window is visible
            pid = get_window_pid(hwnd)
            if pid not in checked_pids:
                checked_pids.add(pid)
                print(f"Checking window for PID: {pid}")  # Debugging output
                close_window(hwnd)  # Close the visible window
        return True

    ENUM_WINDOWS_PROC = ctypes.WINFUNCTYPE(ctypes.c_bool, ctypes.c_int, ctypes.POINTER(ctypes.c_int))
    EnumWindows(ENUM_WINDOWS_PROC(callback), 0)  # Enumerate windows

def close_all_programs():
    print("Closing visible apps...")
    close_running_apps()

def power_off_pc_timer():
    def start_shutdown():
        try:
            timer = int(timer_entry.get())
            if timer > 0:
                response = messagebox.askyesno("Power Off", f"Are you sure you want to power off the PC in {timer} seconds?")
                if response:
                    subprocess.run(f"shutdown /s /f /t {timer}", shell=True)
                    power_off_window.destroy()  # Close the timer window after starting shutdown
            else:
                messagebox.showerror("Invalid Input", "Please enter a valid number of seconds.")
        except ValueError:
            messagebox.showerror("Invalid Input", "Please enter a valid integer for the timer.")

    power_off_window = tk.Toplevel()
    power_off_window.title("Set Timer for Power Off")
    power_off_window.config(bg="#f0f0f0")

    timer_label = tk.Label(power_off_window, text="Enter timer in seconds:", font=("Helvetica", 12))
    timer_label.pack(pady=10)

    timer_entry = tk.Entry(power_off_window, font=("Helvetica", 12))
    timer_entry.pack(pady=10)

    start_button = tk.Button(power_off_window, text="Start Shutdown Timer", command=start_shutdown, width=20, height=2, bg="#f44336", fg="white", font=("Helvetica", 12))
    start_button.pack(pady=10)

def open_roblox():
    def open_link(link):
        webbrowser.open(link)

    roblox_window = tk.Toplevel()
    roblox_window.title("Choose a Roblox Link")
    roblox_window.config(bg="#f0f0f0")

    btn_link1 = tk.Button(roblox_window, text="FischðŸŽ£", command=lambda: open_link("https://www.roblox.com/share?code=b110ad7f52760d43818edb8594b5109b&type=Server"), width=20, height=2, bg="#008CBA", fg="white", font=("Helvetica", 12))
    btn_link1.pack(pady=10)

    btn_link2 = tk.Button(roblox_window, text="jujutsu shaningunsðŸ‘Š", command=lambda: open_link("https://www.roblox.com/share?code=a3d1d8cdf53e6447879a71b19d0db5ea&type=Server"), width=20, height=2, bg="#008CBA", fg="white", font=("Helvetica", 12))
    btn_link2.pack(pady=10)

    btn_link3 = tk.Button(roblox_window, text="strongest batlegroundðŸ‘‘", command=lambda: open_link("https://www.roblox.com/share?code=df1d4f0212fa6349af59f888f1590e0f&type=Server"), width=20, height=2, bg="#008CBA", fg="white", font=("Helvetica", 12))
    btn_link3.pack(pady=10)

    btn_link4 = tk.Button(roblox_window, text="piggyðŸ“ž", command=lambda: open_link("https://www.roblox.com/explore"), width=20, height=2, bg="#008CBA", fg="white", font=("Helvetica", 12))
    btn_link4.pack(pady=10)

def open_website():
    webbrowser.open("https://www.example.com")  # Replace with your desired website

def main():
    global btn_update, btn_good_maker

    root = tk.Tk()
    root.title("Control Center")
    root.geometry("400x600")
    root.config(bg="#f5f5f5")

    title_label = tk.Label(root, text="PC Control Center", font=("Helvetica", 16, "bold"), bg="#f5f5f5", fg="#333")
    title_label.pack(pady=20)

    btn_good_maker = tk.Button(root, text="Good Maker", command=show_compliment, width=20, height=2, bg="#4CAF50", fg="white", font=("Helvetica", 12))
    btn_good_maker.pack(pady=10)
 
    btn_roblox = tk.Button(root, text="Roblox", command=open_roblox, width=20, height=2, bg="#008CBA", fg="white", font=("Helvetica", 12))
    btn_roblox.pack(pady=10)

    btn_close_apps = tk.Button(root, text="C.A.L", command=close_all_programs, width=20, height=2, bg="#9E9E9E", fg="white", font=("Helvetica", 12))
    btn_close_apps.pack(pady=10)

    btn_shutdown = tk.Button(root, text="Shutdown", command=power_off_pc_timer, width=20, height=2, bg="#f44336", fg="white", font=("Helvetica", 12))
    btn_shutdown.pack(pady=10)

    btn_update = tk.Button(root, text="Update", command=update_script, width=20, height=2, bg="#FF9800", fg="white", font=("Helvetica", 12))
    btn_update.pack(pady=10)

    btn_website = tk.Button(root, text="Visit Website", command=open_website, width=20, height=2, bg="#FF5722", fg="white", font=("Helvetica", 12))
    btn_website.pack(pady=10)

    root.mainloop()

if __name__ == "__main__":
    main()
